import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.springframework.jdbc.datasource.DriverManagerDataSource;

import javax.sql.DataSource;
import java.util.Properties;

import static org.assertj.core.api.Assertions.assertThat;

public class AusRdsAuroraMySqlConfigurationLocalTest {

    private AusRdsAuroraMySqlConfigurationLocal configuration;

    @BeforeEach
    void setUp() {
        configuration = new AusRdsAuroraMySqlConfigurationLocal() {
            @Override
            protected Properties getProps() {
                Properties props = new Properties();
                // Set default properties if needed
                return props;
            }
        };
    }

    @Test
    void testDataSourceWhenAuthTokenIsNa() {
        // Set dbAuthToken to "na"
        configuration.dbAuthToken = "na";

        DataSource dataSource = configuration.ausRdsAuroraMySqlDataSource();
        Properties props = ((DriverManagerDataSource) dataSource).getConnectionProperties();

        assertThat(props.getProperty("PROP_AWS_IAM")).isEqualTo(Boolean.TRUE.toString());
        assertThat(props.getProperty("password")).isNull();
    }

    @Test
    void testDataSourceWhenAuthTokenIsProvided() {
        // Set dbAuthToken to some value
        configuration.dbAuthToken = "someAuthToken";

        DataSource dataSource = configuration.ausRdsAuroraMySqlDataSource();
        Properties props = ((DriverManagerDataSource) dataSource).getConnectionProperties();

        assertThat(props.getProperty("PROP_AWS_IAM")).isEqualTo(Boolean.FALSE.toString());
        assertThat(props.getProperty("password")).isEqualTo("someAuthToken");
    }
}
